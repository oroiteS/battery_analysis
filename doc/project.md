# 储能电池寿命分析及算法测试平台（Project）

## 1. 项目背景与目标

本项目面向“储能电池寿命分析及算法测试”场景，建设一套用于**电池数据分析、模型训练对比、模型测试预测与可视化展示**的 Web 平台。平台以课程提供/指定的 **Severson Battery 内置数据集**为唯一数据源，完成从数据浏览分析 → 训练 → 测试 → 指标对比 的闭环，支撑课程综合实践与答辩展示。

核心目标：

- 管理并可视化展示电池全生命周期数据（**仅内置数据集**）。
- 提供算法训练平台：支持 Baseline、BiLSTM、DeepHPM 三种算法训练与对比。
- 提供算法测试平台：对电池 RUL 与 PCL 进行预测，**在线生成预测曲线并与真实曲线对比**。
- 提供多维度性能评估：RMSPE、MSE、R² 等核心指标，并支持多算法对比。

---

## 2. 需求范围（功能边界）

### 2.1 必做功能（MVP）

#### A. 用户体系（登录/注册）

- 支持注册、登录、退出、获取当前用户信息（JWT）。
- 用于隔离训练任务、模型版本、测试任务等记录（不同用户互不影响）。
- **不提供用户数据上传、共享、协作、角色权限管理**。

> 如果课程不要求多用户体系，该模块可视为加分项；但不影响核心训练/测试闭环。

#### B. 电池数据管理与分析（内置数据集）

- 内置数据集包含 **124 个电池单元**，字段包括：
  - 8 项特征（feature_1~feature_8）
  - 循环次数（cycle_num / cycle count）
  - 标签：RUL（Remaining Useful Life）、PCL（Percentage Capacity Loss）
- 数据集划分方式：**使用 `.mat` 数据文件自带划分**（train/val/test）。
  - 系统入库时将每个电池写入 `group_tag=train/val/test`，训练与测试默认按该划分执行。

支持分析能力：

- 统计分析：均值、方差、极值、分布等
- 相关性分析：特征与 RUL/PCL 的相关性、相关性矩阵热力图
- 趋势分析：特征与标签随 cycle 的变化趋势

可视化要求（至少覆盖）：

- 折线图：特征随 cycle 变化、PCL/RUL 退化曲线
- 散点图：RUL/PCL 与关键特征关系
- 直方图：PCL 或 RUL 分布
- 热力图：多特征相关性矩阵

#### C. 算法训练平台（Training）

目标：支持同一套数据划分下，多算法训练与指标对比。

1) 支持算法
- Baseline（数据驱动前馈神经网络）
- BiLSTM（双向 LSTM）
- DeepHPM（深度混合物理模型：数据驱动 + 动态模型约束）
  
  > 三个算法均基于参考实现进行工程化整合。
2) 数据划分
- 使用内置数据集的 `.mat` 自带划分（train/val/test）。
- 平台训练时不允许用户自行改划分（保证可复现与公平对比）。
3) 可配置参数（建议保留必要项）
- 预测目标：RUL、PCL 或两者（BOTH）
- 窗口长度 `seq_len`（滑动窗口序列长度）
- 训练轮数、学习率等基础超参
- （可选）模型规模参数：隐藏层数/神经元数/LSTM隐藏维度等
- （可选）“快速模式/标准模式”预设（用于在笔记本环境稳定运行）
4) 训练过程监控（实时展示）
- 任务状态：PENDING / RUNNING / SUCCEEDED / FAILED / CANCELED
- 实时输出：训练日志、epoch 进度、loss 曲线
- 实时指标（至少）：RMSPE、MSE、R²（可按 train/val/test 分组展示）
5) 训练结果与对比
- 每个算法训练完成后产出一个“模型版本（Model Version）”
- 同一训练任务中支持选择多个算法运行，最终在训练详情页提供：
  - 指标对比表（多算法同屏）
  - loss/指标曲线（按算法切换）

#### D. 算法测试平台（Testing）

目标：满足“实时预测与展示：在线生成 RUL 和 PCL 预测曲线、与实际退化曲线对比分析”。

1) 测试任务创建
- 选择模型版本（model_version）
- 选择测试电池（可单个或多个；默认使用 test 组电池）
- 预测目标：RUL / PCL / BOTH
- 预测配置：预测步长 `horizon`
  - 定义：对指定电池从某个起点开始预测未来 `horizon` 步（可用滚动预测实现）
2) 测试任务运行
- 状态：PENDING / RUNNING / SUCCEEDED / FAILED / CANCELED
- 进度：按电池/样本推进
- 日志：输出当前处理电池、已完成数量、阶段性信息
3) 测试结果展示（核心）
- 总体指标：RMSPE、MSE、R²（按 RUL/PCL 分开展示）
- 预测曲线对比：`y_pred` vs `y_true` 随 cycle 的曲线
- 支持按电池切换查看曲线
- （可选加分）误差分析：残差曲线、残差分布、困难样本电池排行
4) 导出（可选但强烈建议）
- 导出 CSV 或 XLSX
- 至少包含：battery_code、cycle_num、y_true、y_pred（RUL/PCL），以及总体指标汇总

---

## 3. 暂不纳入范围（明确删掉）

- 用户上传数据集（MAT/CSV/XLSX 上传与解析）
- 数据集切换（内置 vs 上传）
- 多数据源管理、配额控制、团队协作
- 在线单点“交互式逐步预测”（本项目以任务式批量预测为主）

---

## 4. 技术栈与架构

### 4.1 技术栈

- 后端：FastAPI（REST API + WebSocket）
- 深度学习：PyTorch
- 数据库：MySQL（电池数据、任务、指标、模型版本、日志）
- 前端：Vue 3 + Element Plus
- 实时：WebSocket 推送训练/测试进度与日志（或轮询作为降级方案）

### 4.2 架构分层

- Web 前端：登录、数据分析可视化、训练任务管理、测试任务管理、曲线对比、导出入口
- API 服务（FastAPI）：
  - 用户、数据查询、训练、测试、模型版本 API
  - WebSocket：推送训练/测试进度与日志
- Worker（可实现为后台线程/独立进程）：
  - 执行训练与测试推理任务
  - 写入任务状态、指标、日志与模型文件

---

## 5. 核心流程（端到端闭环）

1) 用户注册/登录
2) 数据分析页：浏览电池列表 → 查看特征/标签趋势、相关性与统计图
3) 创建训练任务：选择目标（RUL/PCL/BOTH）+ 选择算法（1~3个）+ 设置超参
4) 训练过程：实时展示日志/进度/指标曲线
5) 训练完成：每个算法产出模型版本（可在模型库查看/下载）
6) 创建测试任务：选择模型版本 + 选择测试电池 + 配置 `horizon`
7) 测试过程：实时展示进度与日志
8) 测试结果：展示预测曲线 vs 真实曲线，输出总体/分电池指标，对比不同算法效果
9) （可选）导出测试结果 CSV/XLSX

---

## 6. 验收要点（建议对照答辩展示）

- 内置数据集可查询与可视化展示（含 PCL/RUL 曲线、相关性热力图）
- 三个算法至少能跑通 Baseline，另外两个可逐步完成（以课程要求为准）
- 训练平台：多算法训练与指标对比（RMSPE/MSE/R²）
- 测试平台：在线生成预测曲线并与真实曲线对比分析（RUL 与 PCL）
- API 文档：FastAPI Swagger 可用（加分项）~~~~
